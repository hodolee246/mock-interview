### 뉴스 피드 시스템 설계

정리
웹 서버는 한 사용자가 올릴 수 있는 포스팅의 수를 제한해야한다.

### 포스팅 전송(팬아웃) 서비스
어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정이다.
1. 쓰기 시점의 팬아웃
2. 읽기 시점의 팬아웃

### 쓰기 시점의 팬아웃
새로운 포스팅이 기록하는 시점에 뉴스 피드를 갱신한다. 다시 말해, 포스팅이 완료되면 바로 해당 사용자의 캐시에 해당 포스팅을 기록하는 것이다.
장점
 - 뉴스 피드가 실시간으로 갱신되며, 친구 목록에 있는 사용자에게 즉시 전송됨
 - 새 포스팅이 기록되는 순간에 뉴스 피드가 이미 갱신됨으로 뉴시 피드를 읽는 데 시간이 짧아진다
단점
 - 핫키 문제(친구가 많으면 많을 수록 갱신하는데 많은 시간이 소요)
 - 서비스를 자주 이용하지 않는 사용자까지 피드를 갱신 해 컴퓨팅 자원이 낭비

### 읽기 시점의 팬아웃
피드를 읽어야 하는 시점에 뉴스 피드를 갱신한다. 따라서 요청 기반 모델이며, 사용자가 본인 홈페이지나 타임라인을 로딩하는 시점에 새로운 포스트를 가져오게 된다.
장점
 - 로그인하기까지는 어떤 컴퓨팅 자원도 낭비하지 않음 (로그인 사용자만 갱신시킴)
 - 데이터를 친구 각각에 푸쉬하는 작업이 필요없어 핫키 문제도 없음
단점
 - 뉴스 피드가 많이 쌓여있을 경우 읽는데 많은 시간이 소요될 수 있다.

중요하다고 생각한 부분
포스팅 전송(팬아웃) 서비스
 - 쓰기시점
 - 읽기시점
책과 생각이 다른 부분
X
개인적인 생각
웹기준으로 읽기 시점의 팬아웃 + 쓰기시점 (향 첨가?) 느낌이 있다고 생각
 - 사용자가 직접 나 갱신할래! 하고 갱신하는 경우
 - 특정 트리거 (포스팅 작성 및 행위 시)로 갱신하는 경우
   - 포스팅 작성 시 모든 사용자에게 전달되는 핫키 문제 등 그런건 없긴함 (그래서 모호함)
### 채팅 시스템 설계
폴링
주기적으로 클라이언트가 서버에게 너 메세지 있어? 물어보는 방법
 - 자주 할 수록 서버자원 낭비
롱 폴링
 - 클라이언트는 새 메세지가 반환되거나 타임아웃 될 때까지 연결을 유지. 클라이언트는 새 메세지를 받으면 기존 연결을 종료하고
 - 서버에 새로운 요청을 보내어 모든 절차를 다시 시작한다.
단점
 - 메세지를 보내는 클라이언트와 수진하는 클라이언트가 같은 채팅 서버에 접속하게 되지 않을 수 있다 HTTP 서버들은 보통 무상태 서버다. 로드밸런싱을 위해 라운드 로빈 알고리즘을 사용하는 경우, 메세지를 받은 서버는 해당 메세지를 수신할 클라이언트와의 롤 폴링 연결을 가지고 있지 않은 서버일 수 있는 것이다.

### 설계
 - 채팅 서버는 클라이언트 사이에 메세지를 중계하는 역할을 담당
 - 접속상태 서버는 사용자의 접속 여부를 관리
 - API 서비는 로그인, 회원가입, 프로파일 변경 등 그외 나머지 전부 처리
 - 알림 서버는 푸쉬 알림 보냄
 - 채팅 이력은 key-value store에 저장 시스템에 접속한 사용자는 모든 채팅이력을 볼 수 있음
   - 기본적인 애들은 RDB 그 외 메세지는 NoSQL

중요하다고 생각한 부분
1. 채팅의 읽기, 쓰기의 비중은 1:1 이다.
   -> 자기 성향에 따라 말하기, 듣기 성향을 생각하면 잘못된 생각임 (나는 주로 듣는걸 많이 들어서 딱 1:1을 들었을 때 단순하면서 당연한거를 놓친 느낌이였음)
2. 채팅 이력의 경우 페이스북, 디스코드 모두 NoSQL을 쓸정도로 자주 사용된다
   -> 데이터 접근 지연시간이 낮음
   -> RDB 데이터 가운데 롱 테일에 해당하는 부분을 잘 처리못하는 경향이 있으며, 인덱스가 커지면 데이터에 대한 무작위 접근을 처리하는 비용이 늘어난다.
책과 생각이 다른 부분
X
개인적인 생각
1. message_id의 유일성은 같은 그룹에서만 보장 why? : 순서는 같은 채널 혹은 1:1 채팅 세션에서만 유지되면 충분하다.
   -> 책에서는 진짜 대규모가 아닌 약간 미니멈한 느낌이라 이 방법을 사용한건지?
   -> 같은 그룹에서의 유일성 보장은 알겠는데 언제 message가 발행되었는지 통계같은것도 낼 수 있으면 좋지 않은가?
   -> 채팅 서비스를 만들어본적이 없어서 그런지 이 부분은 스노플레이크가 더 좋아보이긴 함